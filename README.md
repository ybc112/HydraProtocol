# HydraProtocol

> ğŸŒŠ åŸºäºé›¶çŸ¥è¯†è¯æ˜çš„å»ä¸­å¿ƒåŒ–éšç§æ•°æ®å¸‚åœº | è®©æ•°æ®ä»·å€¼æµåŠ¨ï¼Œè®©éšç§ä¸å¯ä¾µçŠ¯

<div align="center">

[![Sui](https://img.shields.io/badge/Sui-Blockchain-blue)](https://sui.io)
[![Walrus](https://img.shields.io/badge/Walrus-Storage-green)](https://walrus.xyz)
[![ZK-SNARKs](https://img.shields.io/badge/ZK--SNARKs-Groth16-purple)](https://github.com/iden3/snarkjs)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)
[![Build](https://img.shields.io/badge/Build-Passing-brightgreen)](https://github.com)
[![Coverage](https://img.shields.io/badge/Coverage-85%25-green)](https://github.com)

[English](./README_EN.md) | ç®€ä½“ä¸­æ–‡ | [ğŸ“– æ–‡æ¡£](./docs) | [ğŸ¬ æ¼”ç¤ºè§†é¢‘](#) | [ğŸ’¬ Discord](#)

</div>

## ğŸ“– é¡¹ç›®ç®€ä»‹

**HydraProtocol** æ˜¯ä¸€ä¸ªé©å‘½æ€§çš„å»ä¸­å¿ƒåŒ–éšç§æ•°æ®å¸‚åœºï¼Œä¸“ä¸º**åŒ»ç–—ã€é‡‘èã€ç§‘ç ”**ç­‰æ•æ„Ÿæ•°æ®åœºæ™¯è®¾è®¡ã€‚é€šè¿‡ç»“åˆ **Sui é«˜æ€§èƒ½åŒºå—é“¾**ã€**Walrus å»ä¸­å¿ƒåŒ–å­˜å‚¨**å’Œ**é›¶çŸ¥è¯†è¯æ˜æŠ€æœ¯**ï¼Œå®ç°äº†æ•°æ®çš„å®‰å…¨å…±äº«ã€éšç§è®¡ç®—å’Œä»·å€¼äº¤æ¢ã€‚

### ğŸ¯ æ ¸å¿ƒä»·å€¼ä¸»å¼ 

- **æ•°æ®æ‰€æœ‰è€…**ï¼šä¿ç•™æ•°æ®ä¸»æƒï¼ŒæŒ‰éœ€æˆæƒï¼Œè·å¾—æ”¶ç›Šï¼ˆ92.5%åˆ†æˆï¼‰
- **æ•°æ®ä½¿ç”¨è€…**ï¼šæ— éœ€ä¿¡ä»»ä¸­ä»‹ï¼Œå¯†ç å­¦ä¿è¯æ•°æ®çœŸå®æ€§ï¼Œæ”¯æŒéšç§è®¡ç®—
- **ç›‘ç®¡åˆè§„**ï¼šæ‰€æœ‰æ“ä½œé“¾ä¸Šå¯å®¡è®¡ï¼Œæ”¯æŒ GDPR/HIPAA åˆè§„è¦æ±‚
- **å¼€å‘è€…å‹å¥½**ï¼šå®Œæ•´ SDKã€TypeScript ç±»å‹æ”¯æŒã€è¯¦ç»†æ–‡æ¡£

### âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ” **å†›äº‹çº§åŠ å¯†**
  - AES-256-GCM å¯¹ç§°åŠ å¯†ï¼ˆ200MB/s æµè§ˆå™¨åŸç”Ÿæ€§èƒ½ï¼‰
  - X25519 ECDH å¯†é’¥äº¤æ¢ï¼ˆ128-bit å®‰å…¨å¼ºåº¦ï¼‰
  - PBKDF2 (100k iterations) æœ¬åœ°å¯†é’¥ä¿æŠ¤
  - ç«¯åˆ°ç«¯åŠ å¯†ï¼Œæ•°æ®æ°¸ä¸æ˜æ–‡ä¸Šé“¾

- ğŸ” **é›¶çŸ¥è¯†éšç§è®¡ç®—**
  - Groth16 è¯æ˜ç³»ç»Ÿï¼ˆ192å­—èŠ‚è¯æ˜ï¼Œ<1msé“¾ä¸ŠéªŒè¯ï¼‰
  - æµè§ˆå™¨ç«¯è¯æ˜ç”Ÿæˆï¼ˆæ•°æ®ä¸ç¦»å¼€æœ¬åœ°ï¼‰
  - æ”¯æŒ Averageã€Threshold ç­‰ç»Ÿè®¡æŸ¥è¯¢
  - å¯æ‰©å±•ç”µè·¯ç³»ç»Ÿï¼ˆæ–¹å·®ã€å›å½’åˆ†æç­‰ï¼‰

- ğŸŒŠ **ä¼ä¸šçº§å­˜å‚¨**
  - Walrus 5x çº åˆ ç å†—ä½™ï¼ˆå®¹å¿ 2 èŠ‚ç‚¹æ•…éšœï¼‰
  - æˆæœ¬ä¼˜åŠ¿ï¼š$0.01/MB vs é“¾ä¸Š $50/MB
  - æ°¸ä¹…å­˜å‚¨ï¼Œæ— éœ€ç»­è´¹
  - é«˜ååé‡ï¼ˆ~5MB/s ä¸Šä¼ é€Ÿåº¦ï¼‰

- âš¡ **æè‡´æ€§èƒ½**
  - Sui åŒºå—é“¾ï¼š~0.5ç§’äº¤æ˜“ç¡®è®¤
  - Gas è´¹ç”¨ï¼š~$0.02-0.05/äº¤æ˜“
  - å¹¶å‘å¤„ç†ï¼š>10K TPS
  - WebSocket å®æ—¶äº‹ä»¶æ¨é€

- ğŸ’° **å…¬å¹³æ¿€åŠ±**
  - æ•°æ®æ‰€æœ‰è€…ï¼š92.5% æ”¶ç›Šåˆ†æˆ
  - éªŒè¯è€…å¥–åŠ±æ± ï¼š5% è‡ªåŠ¨åˆ†é…
  - å¹³å°è´¹ï¼š2.5% ç»´æŠ¤å¼€å‘
  - è´¨æŠ¼æŒ–çŸ¿ï¼š8-12% APY

### ğŸ¯ åº”ç”¨åœºæ™¯

#### ğŸ¥ åŒ»ç–—å¥åº·
- **å¤šä¸­å¿ƒä¸´åºŠè¯•éªŒ**ï¼šå¤šå®¶åŒ»é™¢è”åˆç»Ÿè®¡æ‚£è€…æ¢å¤ç‡ï¼Œæ— éœ€å…±äº«ç—…å†
- **ç–¾ç—…é¢„æµ‹æ¨¡å‹**ï¼šåŸºäºéšç§æ•°æ®è®­ç»ƒ AI æ¨¡å‹ï¼Œç¬¦åˆ HIPAA åˆè§„
- **è¯ç‰©ç ”å‘**ï¼šåˆ¶è¯å…¬å¸è´­ä¹°åŒ¿ååŒ–æ‚£è€…æ•°æ®è¿›è¡Œåˆ†æ

#### ğŸ’¼ é‡‘èç§‘æŠ€
- **ä¿¡ç”¨è¯„åˆ†**ï¼šå¤šå®¶é“¶è¡Œè”åˆè®¡ç®—å®¢æˆ·ä¿¡ç”¨ï¼Œä¸æ³„éœ²äº¤æ˜“æ˜ç»†
- **åæ¬ºè¯ˆæ£€æµ‹**ï¼šå…±äº«æ¬ºè¯ˆæ¨¡å¼ç‰¹å¾ï¼Œä¿æŠ¤å®¢æˆ·éšç§
- **é£é™©è¯„ä¼°**ï¼šåŸºäºåŠ å¯†æ•°æ®çš„è´·æ¬¾è¿çº¦ç‡ç»Ÿè®¡

#### ğŸ”¬ ç§‘ç ”æ•™è‚²
- **åŸºå› ç»„ç ”ç©¶**ï¼šå…±äº«åŸºå› æ•°æ®è¿›è¡Œç–¾ç—…å…³è”åˆ†æï¼Œä¿æŠ¤ä¸ªäººéšç§
- **ç¤¾ä¼šç§‘å­¦è°ƒæŸ¥**ï¼šæ•æ„Ÿé—®å·æ•°æ®çš„éšç§ç»Ÿè®¡
- **AI è®­ç»ƒæ•°æ®é›†**ï¼šå‡ºå”®é«˜è´¨é‡æ ‡æ³¨æ•°æ®ï¼Œä¿ç•™æ•°æ®ä¸»æƒ

#### ğŸ“Š ä¼ä¸šæ•°æ®åä½œ
- **ä¾›åº”é“¾ä¼˜åŒ–**ï¼šå¤šæ–¹åº“å­˜æ•°æ®è”åˆåˆ†æï¼Œä¸æ³„éœ²å•†ä¸šæœºå¯†
- **å¸‚åœºè°ƒç ”**ï¼šè´­ä¹°ç«å“æ•°æ®è¿›è¡Œåˆ†æï¼Œä¿æŠ¤æ•°æ®æº
- **ç”¨æˆ·è¡Œä¸ºåˆ†æ**ï¼šç¬¦åˆ GDPR çš„è·¨å¹³å°ç”¨æˆ·ç»Ÿè®¡

---

## ğŸŒŸ æ ¸å¿ƒåˆ›æ–°ç‚¹

### 1. **å…¨çƒé¦–ä¸ª Sui + Walrus + zkSNARKs å…¨æ ˆé›†æˆæ–¹æ¡ˆ**

**æŠ€æœ¯çªç ´**ï¼š
- âœ… é¦–æ¬¡å°† Walrus å»ä¸­å¿ƒåŒ–å­˜å‚¨ä¸ Sui åŸç”Ÿ Groth16 éªŒè¯å™¨æ·±åº¦æ•´åˆ
- âœ… æµè§ˆå™¨ç«¯ ZKP ç”Ÿæˆ + é“¾ä¸ŠéªŒè¯çš„å®Œæ•´é—­ç¯
- âœ… æ— éœ€ä¸­å¿ƒåŒ–è®¡ç®—èŠ‚ç‚¹ï¼Œæ‰€æœ‰è¯æ˜åœ¨ç”¨æˆ·æœ¬åœ°ç”Ÿæˆ

**ä¸ç«å“å¯¹æ¯”**ï¼š
| ç‰¹æ€§ | Ocean Protocol | Streamr | Enigma | **HydraProtocol** |
|------|----------------|---------|--------|-------------------|
| å­˜å‚¨æ–¹æ¡ˆ | IPFS (ä¸­å¿ƒåŒ–ç½‘å…³) | ä¸­å¿ƒåŒ–æœåŠ¡å™¨ | é“¾ä¸Šå­˜å‚¨ | **Walrus (5xå†—ä½™)** |
| éšç§è®¡ç®— | âŒ æ—  | âŒ æ—  | MPC (éœ€å¤šæ–¹åœ¨çº¿) | **ZKP (å•æ–¹ç”Ÿæˆ)** |
| é“¾ä¸ŠéªŒè¯ | âŒ æ—  | âŒ æ—  | éƒ¨åˆ†æ”¯æŒ | **âœ… Groth16 åŸç”ŸéªŒè¯** |
| å¯†é’¥ç®¡ç† | ä¸­å¿ƒåŒ–æ‰˜ç®¡ | æœªåŠ å¯† | ç§˜å¯†å…±äº« | **X25519 ECDH** |
| åŒºå—é“¾ | ä»¥å¤ªåŠ (æ…¢+è´µ) | è‡ªå»ºé“¾ | ä»¥å¤ªåŠ | **Sui (å¿«+ä¾¿å®œ)** |

### 2. **å®‰å…¨çš„ä¸¤æ­¥å¼å¯†é’¥åˆ†å‘æœºåˆ¶**

**åˆ›æ–°è®¾è®¡**ï¼š
```
ä¼ ç»Ÿæ–¹æ¡ˆçš„é—®é¢˜:
âŒ Ocean Protocol: å¯†é’¥é›†ä¸­å­˜å‚¨åœ¨æœåŠ¡å•†ï¼Œå•ç‚¹æ•…éšœ
âŒ å…¶ä»–æ–¹æ¡ˆ: å¯†é’¥æ˜æ–‡ä¸Šé“¾ï¼Œä»»ä½•äººå¯è§

HydraProtocol çš„è§£å†³æ–¹æ¡ˆ:
ç¬¬ä¸€æ­¥: è´­ä¹°äº¤æ˜“ï¼ˆé“¾ä¸Šå…¬å¼€ï¼‰
  ä¹°å®¶ â†’ æ”¯ä»˜ SUI â†’ è·å¾—è´­ä¹°å‡­è¯
  
ç¬¬äºŒæ­¥: å¯†é’¥åˆ†å‘ï¼ˆé“¾ä¸ŠåŠ å¯†ï¼‰
  å–å®¶ â†’ æ£€æµ‹è´­ä¹°äº‹ä»¶
  å–å®¶ â†’ è·å–ä¹°å®¶ X25519 å…¬é’¥
  å–å®¶ â†’ ECDH åŠ å¯†å¯¹ç§°å¯†é’¥
  å–å®¶ â†’ è°ƒç”¨ distribute_key_to_buyer ä¸Šé“¾
  ä¹°å®¶ â†’ ç”¨ç§é’¥è§£å¯†ï¼Œè·å¾—æ•°æ®è®¿é—®æƒ

å®‰å…¨ä¿è¯:
âœ… å¯†é’¥å¯†æ–‡ä¸Šé“¾ï¼Œä»»ä½•ç¬¬ä¸‰æ–¹æ— æ³•è§£å¯†
âœ… ä¹°å®¶çš„ X25519 ç§é’¥ä½¿ç”¨å¯†ç åŠ å¯†åå­˜å‚¨åœ¨ IndexedDBï¼Œæ°¸ä¸ä¸Šä¼ 
âœ… å¯¹ç§°åŠ å¯†å¯†é’¥åŒæ ·ä½¿ç”¨ PBKDF2 + AES-GCM ä¿æŠ¤ï¼Œä¸å†æ˜æ–‡å­˜å‚¨
âœ… æ”¯æŒå¯†é’¥æ’¤é”€å’Œè®¿é—®æƒé™è¿‡æœŸç®¡ç†
```

### 3. **Threshold Queryï¼ˆé˜ˆå€¼æŸ¥è¯¢ï¼‰- ç‹¬åˆ›çš„éšç§ç»Ÿè®¡æ–¹æ³•**

**åº”ç”¨ç¤ºä¾‹**ï¼š
```
åœºæ™¯: æŸé“¶è¡Œæƒ³çŸ¥é“å®¢æˆ·ç¾¤ä½“ä¸­"å¹´æ”¶å…¥ > 50ä¸‡"çš„äººæ•°æ¯”ä¾‹

ä¼ ç»ŸSQLæŸ¥è¯¢:
  SELECT COUNT(*) FROM customers WHERE income > 500000;
  âŒ é—®é¢˜: éœ€è¦è®¿é—®æ‰€æœ‰å®¢æˆ·çš„åŸå§‹æ”¶å…¥æ•°æ®

HydraProtocol Threshold Query:
  è¾“å…¥ (ç§æœ‰): income_data = [380k, 520k, 450k, 680k, ...]
  è¾“å…¥ (å…¬å¼€): threshold = 500k
  
  è¾“å‡º (å…¬å¼€): count = 3 (è¡¨ç¤ºæœ‰3äººè¶…è¿‡50ä¸‡)
  è¾“å‡º (å…¬å¼€): commitment = hash(income_data)
  
  ZKP è¯æ˜: "æˆ‘ç¡®å®å¯¹è¿™äº›æ•°æ®æ‰§è¡Œäº†é˜ˆå€¼ç»Ÿè®¡ï¼Œç»“æœä¸º3"
  
  âœ… ä¼˜åŠ¿: é“¶è¡ŒåªçŸ¥é“æ•°é‡ï¼Œæ°¸è¿œæ— æ³•åæ¨å‡ºè°çš„æ”¶å…¥æ˜¯å¤šå°‘
```

**æŠ€æœ¯å®ç°**ï¼š
```circom
// threshold.circom æ ¸å¿ƒé€»è¾‘
component comparators[n];
for (var i = 0; i < n; i++) {
    comparators[i] = GreaterThan(32);
    comparators[i].in[0] <== data[i];      // ç§æœ‰æ•°æ®
    comparators[i].in[1] <== threshold;    // å…¬å¼€é˜ˆå€¼
}

// ç´¯åŠ æ»¡è¶³æ¡ä»¶çš„æ•°é‡
var totalCount = 0;
for (var i = 0; i < n; i++) {
    totalCount += comparators[i].out;  // 0 æˆ– 1
}
count <== totalCount;  // å…¬å¼€è¾“å‡º
```

### 4. **è‡ªåŠ¨åˆ—è¯†åˆ« + æ™ºèƒ½æ•°æ®é‡‡æ ·**

**ç”¨æˆ·ä½“éªŒåˆ›æ–°**ï¼š
```
ä¼ ç»Ÿæ•°æ®å¸‚åœºçš„ç—›ç‚¹:
âŒ éœ€è¦æ‰‹åŠ¨æŒ‡å®šæ•°æ®æ ¼å¼å’Œå­—æ®µæ˜ å°„
âŒ ä¸æ”¯æŒé¢„è§ˆï¼Œä¹°å®¶æ— æ³•è¯„ä¼°æ•°æ®è´¨é‡
âŒ ä¸Šä¼ åæ‰å‘ç°æ ¼å¼ä¸å…¼å®¹

HydraProtocol çš„è‡ªåŠ¨åŒ–æ–¹æ¡ˆ:
âœ… ä¸Šä¼  CSV/Excel/JSONï¼Œè‡ªåŠ¨è§£æåˆ—åå’Œç±»å‹
âœ… æ™ºèƒ½è¯†åˆ«æ•°å€¼åˆ—ï¼ˆå¦‚"å¹´é¾„"ã€"æ”¶å…¥"ã€"è¡€å‹"ï¼‰
âœ… åœ¨åŠ å¯†çŠ¶æ€ä¸‹æ˜¾ç¤ºæ•°æ®é¢„è§ˆï¼ˆæœ€å¤§å€¼ã€æœ€å°å€¼ã€å‡å€¼ï¼‰
âœ… è‡ªåŠ¨é‡‡æ ·æ•°æ®ç”¨äº ZKP è®¡ç®—ï¼ˆæ— éœ€æ‰‹åŠ¨é€‰æ‹©ï¼‰

æŠ€æœ¯å®ç°:
1. å‰ç«¯è¯»å–æ–‡ä»¶ â†’ Papaparse/SheetJS è§£æ
2. è¯†åˆ«åˆ—ç±»å‹ â†’ æ­£åˆ™åŒ¹é…æ•°å€¼/æ—¥æœŸ/æ–‡æœ¬
3. ç”Ÿæˆç»Ÿè®¡æ‘˜è¦ â†’ ä¸æ³„éœ²åŸå§‹æ•°æ®
4. ç”¨æˆ·é€‰æ‹©ç›®æ ‡åˆ— â†’ è‡ªåŠ¨æå–æ•°æ®ç”¨äº ZKP
```

### 5. **æµè§ˆå™¨ç«¯ ZKP ç”Ÿæˆ - æ— éœ€æœåŠ¡å™¨**

**æŠ€æœ¯éš¾ç‚¹**ï¼š
```
ä¼ ç»Ÿ ZKP æ–¹æ¡ˆçš„é™åˆ¶:
âŒ éœ€è¦é«˜æ€§èƒ½æœåŠ¡å™¨ç”Ÿæˆè¯æ˜ï¼ˆæˆæœ¬é«˜ï¼‰
âŒ ç”¨æˆ·éœ€è¦ä¸Šä¼ åŸå§‹æ•°æ®åˆ°æœåŠ¡å™¨ï¼ˆéšç§é£é™©ï¼‰
âŒ è¯æ˜ç”Ÿæˆæ—¶é—´é•¿ï¼ˆå‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶ï¼‰

HydraProtocol çš„æµè§ˆå™¨ç«¯æ–¹æ¡ˆ:
âœ… ä½¿ç”¨ SnarkJS + WebAssembly åœ¨æµè§ˆå™¨ç”Ÿæˆè¯æ˜
âœ… æ•°æ®æ°¸ä¸ç¦»å¼€ç”¨æˆ·è®¾å¤‡
âœ… é’ˆå¯¹ BN254 æ›²çº¿ä¼˜åŒ–ï¼Œ10-30ç§’ç”Ÿæˆè¯æ˜

æ€§èƒ½ä¼˜åŒ–:
- ä½¿ç”¨ Web Workers é¿å…é˜»å¡ UI
- é¢„ç¼–è¯‘ç”µè·¯æ–‡ä»¶ï¼ˆ.wasm + .zkeyï¼‰
- Groth16 è¯æ˜å¤§å°ä»… 192 å­—èŠ‚ï¼Œå¿«é€Ÿä¸Šé“¾
```

### 6. **å®Œæ•´çš„ä»£å¸ç»æµæ¨¡å‹**

**è´¹ç”¨åˆ†é…æœºåˆ¶**ï¼š
```move
// market.move æ ¸å¿ƒä»£ç 
let platform_fee = (price * 250) / 10000;      // 2.5%
let verifier_reward = (price * 500) / 10000;   // 5%
let owner_revenue = price - platform_fee - verifier_reward;  // 92.5%

// èµ„é‡‘æµå‘:
âœ… æ•°æ®æ‰€æœ‰è€…: 92.5% â†’ æ¿€åŠ±é«˜è´¨é‡æ•°æ®ä¸Šä¼ 
âœ… éªŒè¯è€…å¥–åŠ±æ± : 5% â†’ å¥–åŠ±è¿è¡Œ ZKP éªŒè¯çš„èŠ‚ç‚¹
âœ… å¹³å°è´¹: 2.5% â†’ ç»´æŠ¤åŸºç¡€è®¾æ–½å’Œå¼€å‘
```

**è´¨æŠ¼æŒ–çŸ¿**ï¼š
```
æ•°æ®æä¾›è€…è´¨æŠ¼:
- è´¨æŠ¼ â‰¥ 1 SUI åˆ° Marketplace åˆçº¦
- é”å®šæœŸ 24 å°æ—¶
- å¹´åŒ–æ”¶ç›Š ~8-12% (æ ¹æ®å¥–åŠ±æ± åŠ¨æ€è°ƒæ•´)
- æä¾›è™šå‡æ•°æ®å°†è¢«ç½šæ²¡è´¨æŠ¼é‡‘

éªŒè¯è€…è´¨æŠ¼:
- è´¨æŠ¼ â‰¥ 5 SUI
- è¿è¡Œ ZKP éªŒè¯èŠ‚ç‚¹
- ä»å¥–åŠ±æ± è·å¾— 5% çš„äº¤æ˜“è´¹åˆ†æˆ
- éªŒè¯é”™è¯¯è¯æ˜å°†è¢«æƒ©ç½š
```

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å‰ç«¯ (Next.js + React)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ æ•°æ®ä¸Šä¼  â”‚  â”‚ å¸‚åœºæµè§ˆ â”‚  â”‚ ZKPè®¡ç®— â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ RPC/GraphQL
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Sui åŒºå—é“¾ (æ™ºèƒ½åˆçº¦å±‚)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚DataRegistry â”‚ â”‚ Marketplace â”‚ â”‚ZKP Verifier â”‚  â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚             â”‚  â”‚
â”‚  â”‚ â€¢ å…ƒæ•°æ®    â”‚ â”‚ â€¢ äº¤æ˜“å¸‚åœº  â”‚ â”‚ â€¢ ç”µè·¯æ³¨å†Œ  â”‚  â”‚
â”‚  â”‚ â€¢ è®¿é—®æ§åˆ¶  â”‚ â”‚ â€¢ è´¹ç”¨åˆ†é…  â”‚ â”‚ â€¢ è¯æ˜éªŒè¯  â”‚  â”‚
â”‚  â”‚ â€¢ å¯†é’¥ç®¡ç†  â”‚ â”‚ â€¢ è´¨æŠ¼å¥–åŠ±  â”‚ â”‚ â€¢ é“¾ä¸ŠéªŒè¯  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Walrus åˆ†å¸ƒå¼å­˜å‚¨ (æ•°æ®å±‚)                  â”‚
â”‚                                                      â”‚
â”‚    ğŸ—„ï¸ åŠ å¯†æ•°æ® Blob  â†’  5x å†—ä½™  â†’  æ°¸ä¹…å­˜å‚¨        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

             â–²
             â”‚ æœ¬åœ°ç”Ÿæˆ ZKP è¯æ˜
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ZK ç”µè·¯ (Circom + SnarkJS)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   Average   â”‚           â”‚  Threshold  â”‚         â”‚
â”‚  â”‚   (å¹³å‡å€¼)  â”‚           â”‚ (é˜ˆå€¼æŸ¥è¯¢)   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸŒ å·²éƒ¨ç½²çš„æµ‹è¯•ç½‘åˆçº¦

**æ— éœ€éƒ¨ç½²ï¼Œç›´æ¥ä½¿ç”¨ï¼** æˆ‘ä»¬å·²åœ¨ Sui Testnet éƒ¨ç½²äº†å®Œæ•´çš„åˆçº¦ç³»ç»Ÿï¼š

```bash
# æ ¸å¿ƒåˆçº¦åœ°å€
Package ID:        0xc06de3e29a173a088c5b5f75632e2ef67e9ab1d09e65336589a514d79f1b010d
Data Registry:     0x77719a8321b655e54aca1ca819c726647109640ea3e7200deadf1b8544d24137
Marketplace:       0x402c64be994b79de4f565e5d6463191df801535eea82d32e1da67ffa65b37d67
ZKP Registry:      0x2a5e682613f69ffec125e7accf407abdc11b8289f4d298c019b595466ab698cb

# Walrus å­˜å‚¨ç«¯ç‚¹
Publisher:         https://publisher.walrus-testnet.walrus.space
Aggregator:        https://aggregator.walrus-testnet.walrus.space

# ç½‘ç»œé…ç½®
Network:           Sui Testnet
```

**å¿«é€Ÿä½“éªŒ**ï¼š
```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/yourusername/HydraProtocol.git
cd HydraProtocol/frontend

# 2. å®‰è£…ä¾èµ–
npm install

# 3. ä½¿ç”¨é¢„é…ç½®çš„æµ‹è¯•ç½‘åœ°å€
npm run dev

# 4. è®¿é—® http://localhost:3000
# è¿æ¥ Sui é’±åŒ…å³å¯å¼€å§‹ä½¿ç”¨ï¼
```

> ğŸ’¡ **æç¤º**ï¼šæµ‹è¯•ç½‘ SUI å¯ä» [Sui Faucet](https://discord.com/channels/916379725201563759/971488439931392130) è·å–

---

### å‰ç½®è¦æ±‚ï¼ˆä»…è‡ªè¡Œéƒ¨ç½²éœ€è¦ï¼‰

- Node.js >= 18
- Sui CLI >= 1.20.0
- Circom 2.1.0
- SnarkJS

### å®‰è£…æ­¥éª¤

#### 1. å…‹éš†ä»“åº“

```bash
git clone https://github.com/yourusername/HydraProtocol.git
cd HydraProtocol
```

#### 2. éƒ¨ç½²æ™ºèƒ½åˆçº¦ï¼ˆå¯é€‰ï¼‰

> âš ï¸ **æ³¨æ„**ï¼šå¦‚æœä½¿ç”¨ä¸Šè¿°æµ‹è¯•ç½‘åœ°å€ï¼Œå¯è·³è¿‡æ­¤æ­¥éª¤

```bash
cd contracts
sui move build
sui client publish --gas-budget 500000000
```

è®°å½•è¾“å‡ºçš„ `PackageID`ã€`DataRegistry ID`ã€`Marketplace ID`ã€`ZKPRegistry ID`ï¼Œå¹¶æ›´æ–° `frontend/.env.local` é…ç½®ã€‚

#### 3. ç¼–è¯‘ ZKP ç”µè·¯

```bash
cd circuits
npm install
bash build_circuits.sh
```

#### 4. æ³¨å†Œç”µè·¯éªŒè¯å¯†é’¥

```bash
cd scripts
npm install

# è®¾ç½®ç§é’¥
export PRIVATE_KEY=suiprivkey1...  # æ‚¨çš„ Sui ç§é’¥

# ä¿®æ”¹ register-circuits.ts ä¸­çš„åˆçº¦åœ°å€
# ç„¶åæ‰§è¡Œæ³¨å†Œ
npm run register-circuits
```

#### 5. å¯åŠ¨å‰ç«¯

```bash
cd frontend
npm install

# é…ç½®ç¯å¢ƒå˜é‡ï¼ˆä½¿ç”¨æµ‹è¯•ç½‘åœ°å€ï¼‰
cp .env.example .env.local

# .env.local å†…å®¹ï¼ˆå·²é¢„é…ç½®æµ‹è¯•ç½‘åœ°å€ï¼‰ï¼š
cat > .env.local << EOF
NEXT_PUBLIC_PACKAGE_ID=0xc06de3e29a173a088c5b5f75632e2ef67e9ab1d09e65336589a514d79f1b010d
NEXT_PUBLIC_DATA_REGISTRY_ID=0x77719a8321b655e54aca1ca819c726647109640ea3e7200deadf1b8544d24137
NEXT_PUBLIC_MARKETPLACE_ID=0x402c64be994b79de4f565e5d6463191df801535eea82d32e1da67ffa65b37d67
NEXT_PUBLIC_ZKP_REGISTRY_ID=0x2a5e682613f69ffec125e7accf407abdc11b8289f4d298c019b595466ab698cb
NEXT_PUBLIC_SUI_NETWORK=testnet
NEXT_PUBLIC_WALRUS_PUBLISHER=https://publisher.walrus-testnet.walrus.space
NEXT_PUBLIC_WALRUS_AGGREGATOR=https://aggregator.walrus-testnet.walrus.space
EOF

npm run dev
```

è®¿é—® `http://localhost:3000` å¼€å§‹ä½¿ç”¨ï¼

**éªŒè¯éƒ¨ç½²**ï¼š
- ğŸ”— [æŸ¥çœ‹ Package](https://suiscan.xyz/testnet/object/0xc06de3e29a173a088c5b5f75632e2ef67e9ab1d09e65336589a514d79f1b010d)
- ğŸ”— [æŸ¥çœ‹ Data Registry](https://suiscan.xyz/testnet/object/0x77719a8321b655e54aca1ca819c726647109640ea3e7200deadf1b8544d24137)
- ğŸ”— [æŸ¥çœ‹ Marketplace](https://suiscan.xyz/testnet/object/0x402c64be994b79de4f565e5d6463191df801535eea82d32e1da67ffa65b37d67)

---

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
HydraProtocol/
â”œâ”€â”€ contracts/              # Sui Move æ™ºèƒ½åˆçº¦
â”‚   â”œâ”€â”€ sources/
â”‚   â”‚   â”œâ”€â”€ data_registry.move    # æ•°æ®æ³¨å†Œä¸è®¿é—®æ§åˆ¶
â”‚   â”‚   â”œâ”€â”€ market.move           # æ•°æ®å¸‚åœºä¸äº¤æ˜“
â”‚   â”‚   â””â”€â”€ zkp_verifier.move     # ZKP éªŒè¯å™¨
â”‚   â””â”€â”€ tests/              # åˆçº¦å•å…ƒæµ‹è¯•
â”‚
â”œâ”€â”€ circuits/               # Circom ZKP ç”µè·¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ average.circom        # å¹³å‡å€¼è®¡ç®—ç”µè·¯
â”‚   â”‚   â””â”€â”€ threshold.circom      # é˜ˆå€¼æŸ¥è¯¢ç”µè·¯
â”‚   â””â”€â”€ build/              # ç¼–è¯‘äº§ç‰©ï¼ˆ.wasm, .zkey, vk.jsonï¼‰
â”‚
â”œâ”€â”€ frontend/               # Next.js å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/            # é¡µé¢è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ components/     # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ hooks/          # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â””â”€â”€ utils/          # å·¥å…·å‡½æ•°ï¼ˆZKPã€åŠ å¯†ã€Walrusï¼‰
â”‚   â””â”€â”€ public/circuits/    # æµè§ˆå™¨ç«¯ ZKP ç”µè·¯æ–‡ä»¶
â”‚
â”œâ”€â”€ scripts/                # éƒ¨ç½²ä¸æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ register-circuits.ts     # ç”µè·¯æ³¨å†Œè„šæœ¬
â”‚   â””â”€â”€ create-listings.ts       # åˆ›å»ºç¤ºä¾‹æ•°æ®æŒ‚ç‰Œ
â”‚
â””â”€â”€ sdk/                    # TypeScript SDKï¼ˆå¯é€‰ï¼‰
    â””â”€â”€ typescript/
```

---

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹è¯¦è§£

### æ•°æ®ç”Ÿå‘½å‘¨æœŸå…¨æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¬¬1é˜¶æ®µ: æ•°æ®ä¸Šä¼ ä¸æ³¨å†Œ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åŒ»é™¢A (æ•°æ®æ‰€æœ‰è€…)
  â”‚
  â”œâ”€ 1. å‡†å¤‡æ•°æ®æ–‡ä»¶ (patients.csv)
  â”‚    â”œâ”€ åŒ…å«: æ‚£è€…ID, å¹´é¾„, æ€§åˆ«, æ¢å¤å¤©æ•°ç­‰
  â”‚    â””â”€ ç¤ºä¾‹: 30æ¡æ‚£è€…è®°å½•
  â”‚
  â”œâ”€ 2. æµè§ˆå™¨è‡ªåŠ¨åŠ å¯†
  â”‚    â”œâ”€ ç”Ÿæˆéšæœº AES-256-GCM å¯†é’¥ (256-bit)
  â”‚    â”œâ”€ åŠ å¯†æ•´ä¸ªCSVæ–‡ä»¶ â†’ encrypted_blob
  â”‚    â””â”€ è®¡ç®—SHA-256å“ˆå¸Œ â†’ data_hash
  â”‚
  â”œâ”€ 3. ä¸Šä¼ åˆ° Walrus
  â”‚    â”œâ”€ POST encrypted_blob â†’ Walrus Aggregator
  â”‚    â”œâ”€ Walrusè¿›è¡Œçº åˆ ç ç¼–ç  (5xå†—ä½™)
  â”‚    â””â”€ è¿”å› Blob ID: "PuwNOqjRj0mh..."
  â”‚
  â”œâ”€ 4. é“¾ä¸Šæ³¨å†Œå…ƒæ•°æ®
  â”‚    â”œâ”€ è°ƒç”¨ data_registry::register_data
  â”‚    â”œâ”€ å‚æ•°: (blob_id, data_hash, size, type, description)
  â”‚    â”œâ”€ ğŸ” ä½¿ç”¨å¯†ç åŠ å¯† AESå¯†é’¥ï¼Œå­˜å‚¨åˆ° IndexedDB (PBKDF2 + AES-GCM)
  â”‚    â””â”€ Suié“¾åˆ›å»º DataRecord å¯¹è±¡
  â”‚
  â””â”€ 5. æŒ‚ç‰Œåˆ°å¸‚åœº
       â”œâ”€ è°ƒç”¨ market::list_data
       â”œâ”€ è®¾ç½®ä»·æ ¼: 10 SUI
       â””â”€ åˆ›å»º DataListing å¯¹è±¡


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¬¬2é˜¶æ®µ: æ•°æ®è´­ä¹°ä¸å¯†é’¥åˆ†å‘                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åŒ»é™¢B (æ•°æ®æ¶ˆè´¹è€…)
  â”‚
  â”œâ”€ 1. æµè§ˆå¸‚åœº
  â”‚    â”œâ”€ æŸ¥çœ‹ DataListing åˆ—è¡¨
  â”‚    â”œâ”€ ç­›é€‰: ç±»å‹=medical, ä»·æ ¼<15 SUI
  â”‚    â””â”€ é¢„è§ˆ: æ•°æ®å¤§å°ã€æè¿°ã€è¯„åˆ†
  â”‚
  â”œâ”€ 2. ç”Ÿæˆ X25519 å¯†é’¥å¯¹ (æµè§ˆå™¨æœ¬åœ°)
  â”‚    â”œâ”€ ç§é’¥: å­˜å‚¨åœ¨ localStorage (æ°¸ä¸ä¸Šä¼ )
  â”‚    â”œâ”€ å…¬é’¥: æ³¨å†Œåˆ° DataRegistry.user_keys
  â”‚    â””â”€ ç”¨äºåç»­æ¥æ”¶åŠ å¯†çš„ AES å¯†é’¥
  â”‚
  â”œâ”€ 3. è´­ä¹°æ•°æ®è®¿é—®æƒ
  â”‚    â”œâ”€ è°ƒç”¨ market::purchase_data_access
  â”‚    â”œâ”€ æ”¯ä»˜: 10 SUI
  â”‚    â”œâ”€ è´¹ç”¨åˆ†é…:
  â”‚    â”‚   â”œâ”€ åŒ»é™¢Aè·å¾—: 9.25 SUI (92.5%)
  â”‚    â”‚   â”œâ”€ å¥–åŠ±æ± : 0.5 SUI (5%)
  â”‚    â”‚   â””â”€ å¹³å°è´¹: 0.25 SUI (2.5%)
  â”‚    â””â”€ åˆ›å»º Purchase å¯¹è±¡ â†’ è½¬ç§»ç»™åŒ»é™¢B
  â”‚
  â”œâ”€ 4. ç­‰å¾…å¯†é’¥åˆ†å‘
  â”‚    â””â”€ ç›‘å¬ KeyDistributed äº‹ä»¶
  â”‚
åŒ»é™¢A (è‡ªåŠ¨è§¦å‘)
  â”‚
  â”œâ”€ 5. æ£€æµ‹è´­ä¹°äº‹ä»¶ (useAutoDistributeKeys hook)
  â”‚    â”œâ”€ ç›‘å¬ DataPurchased äº‹ä»¶
  â”‚    â”œâ”€ éªŒè¯: listing.purchasers[åŒ»é™¢B] = true
  â”‚    â””â”€ è§¦å‘å¯†é’¥åˆ†å‘æµç¨‹
  â”‚
  â”œâ”€ 6. åŠ å¯†å¯†é’¥åˆ†å‘
  â”‚    â”œâ”€ ä»åŠ å¯†çš„ IndexedDB è¯»å– AES å¯†é’¥ï¼ˆéœ€è¾“å…¥å¯†ç è§£å¯†ï¼‰
  â”‚    â”œâ”€ ä»é“¾ä¸Šè¯»å–åŒ»é™¢Bçš„ X25519 å…¬é’¥
  â”‚    â”œâ”€ ECDH å¯†é’¥äº¤æ¢: 
  â”‚    â”‚   shared_secret = ECDH(åŒ»é™¢A_ç§é’¥, åŒ»é™¢B_å…¬é’¥)
  â”‚    â”œâ”€ åŠ å¯† AES å¯†é’¥:
  â”‚    â”‚   encrypted_key = AES-256-GCM(AESå¯†é’¥, shared_secret)
  â”‚    â””â”€ è°ƒç”¨ market::distribute_key_to_buyer
  â”‚        â”œâ”€ å‚æ•°: (listing, data_record, åŒ»é™¢B, encrypted_key)
  â”‚        â””â”€ é“¾ä¸Šå­˜å‚¨: data_record.encryption_keys[åŒ»é™¢B] = encrypted_key
  â”‚
åŒ»é™¢B (è·å¾—è®¿é—®æƒ)
  â”‚
  â””â”€ 7. è§£å¯†è·å¾— AES å¯†é’¥
       â”œâ”€ è¯»å– KeyDistributed äº‹ä»¶ä¸­çš„ encrypted_key
       â”œâ”€ ECDH è§£å¯†:
       â”‚   shared_secret = ECDH(åŒ»é™¢B_ç§é’¥, åŒ»é™¢A_å…¬é’¥)
       â”‚   AESå¯†é’¥ = AES-256-GCM_decrypt(encrypted_key, shared_secret)
       â””â”€ ç°åœ¨å¯ä»¥ä¸‹è½½å¹¶è§£å¯†åŸå§‹æ•°æ®


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç¬¬3é˜¶æ®µ: éšç§è®¡ç®—ä¸é›¶çŸ¥è¯†è¯æ˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åŒ»é™¢B (æ‰§è¡Œéšç§è®¡ç®—)
  â”‚
  â”œâ”€ 1. ä¸‹è½½åŠ å¯†æ•°æ®
  â”‚    â”œâ”€ ä» Walrus ä¸‹è½½ Blob ID: "PuwNOqjRj0mh..."
  â”‚    â””â”€ è·å¾— encrypted_blob (278 bytes)
  â”‚
  â”œâ”€ 2. è§£å¯†æ•°æ®
  â”‚    â”œâ”€ ä½¿ç”¨ä¹‹å‰è·å¾—çš„ AES å¯†é’¥
  â”‚    â”œâ”€ è§£å¯†: AES-256-GCM.decrypt(encrypted_blob, AESå¯†é’¥)
  â”‚    â””â”€ å¾—åˆ°åŸå§‹ CSV: patients.csv
  â”‚
  â”œâ”€ 3. è‡ªåŠ¨åˆ—è¯†åˆ«
  â”‚    â”œâ”€ è§£æ CSV åˆ—: [ID, å§“å, å¹´é¾„, æ€§åˆ«, æ¢å¤å¤©æ•°]
  â”‚    â”œâ”€ è¯†åˆ«æ•°å€¼åˆ—: [å¹´é¾„, æ¢å¤å¤©æ•°]
  â”‚    â””â”€ ç”¨æˆ·é€‰æ‹©ç›®æ ‡åˆ—: "å¹´é¾„"
  â”‚
  â”œâ”€ 4. æå–æ•°æ®ç”¨äº ZKP
  â”‚    â”œâ”€ è¯»å–"å¹´é¾„"åˆ—: [45, 38, 62, ...]
  â”‚    â”œâ”€ éšæœºé‡‡æ · 3 ä¸ªæ•°æ®ç‚¹: [45, 38, 62]
  â”‚    â””â”€ å‡†å¤‡ç”µè·¯è¾“å…¥: { data: [45, 38, 62] }
  â”‚
  â”œâ”€ 5. æµè§ˆå™¨ç«¯ç”Ÿæˆ ZKP è¯æ˜ (10-30ç§’)
  â”‚    â”œâ”€ åŠ è½½ç”µè·¯: average.wasm + circuit_final.zkey
  â”‚    â”œâ”€ ä½¿ç”¨ SnarkJS ç”Ÿæˆ Witness:
  â”‚    â”‚   witness = calculateWitness(average.wasm, {data: [45,38,62]})
  â”‚    â”œâ”€ ç”Ÿæˆ Groth16 è¯æ˜:
  â”‚    â”‚   proof = groth16.prove(circuit_final.zkey, witness)
  â”‚    â”‚   publicSignals = [avg, commitment]
  â”‚    â”‚     - avg = 48 (å¹³å‡å€¼)
  â”‚    â”‚     - commitment = Poseidon([45, 38, 62])
  â”‚    â””â”€ åºåˆ—åŒ–è¯æ˜: proof_bytes (192 bytes)
  â”‚
  â”œâ”€ 6. æäº¤è¯æ˜åˆ°é“¾ä¸Š
  â”‚    â”œâ”€ è°ƒç”¨ zkp_verifier::submit_proof_authorized
  â”‚    â”œâ”€ å‚æ•°: (data_record, proof, publicSignals, "average")
  â”‚    â”œâ”€ è®¿é—®æƒé™æ£€æŸ¥:
  â”‚    â”‚   âœ… has_encrypted_key_for(data_record, åŒ»é™¢B) = true
  â”‚    â””â”€ åˆ›å»º ComputationResult å¯¹è±¡ (verified=false)
  â”‚
  â””â”€ 7. é“¾ä¸ŠéªŒè¯ ZKP
       â”œâ”€ è°ƒç”¨ zkp_verifier::verify_proof
       â”œâ”€ Sui åŸç”Ÿ Groth16 éªŒè¯å™¨æ‰§è¡ŒéªŒè¯ (<1ms)
       â”œâ”€ éªŒè¯é€šè¿‡:
       â”‚   â”œâ”€ result.verified = true
       â”‚   â”œâ”€ è§¦å‘ ProofVerified äº‹ä»¶
       â”‚   â””â”€ é“¾ä¸Šæ°¸ä¹…è®°å½•è®¡ç®—ç»“æœ
       â””â”€ å‰ç«¯å±•ç¤º:
           "âœ… è®¡ç®—æˆåŠŸå¹¶éªŒè¯ï¼
            å¹³å‡å€¼: 48.33
            è®¡ç®—æ•°æ®: [45, 38, 62]
            æ‰¿è¯º: 2163832386098297...
            æäº¤TX: BPZsEcwwe1ut...
            éªŒè¯TX: EbtAZwZGjMYd...
            âœ¨ çŠ¶æ€: VERIFIED"


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç¬¬4é˜¶æ®µ: ç»“æœæŸ¥è¯¢ä¸å®¡è®¡è¿½è¸ª                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä»»ä½•ç”¨æˆ· (å…¬å¼€è®¿é—®)
  â”‚
  â”œâ”€ 1. æŸ¥è¯¢è®¡ç®—å†å²
  â”‚    â”œâ”€ è¯»å– ProofVerified äº‹ä»¶
  â”‚    â”œâ”€ ç­›é€‰: circuit_name = "average"
  â”‚    â””â”€ å±•ç¤º: éªŒè¯æ—¶é—´ã€å…¬å¼€è¾“å…¥ã€æ•°æ®ID
  â”‚
  â”œâ”€ 2. éªŒè¯é“¾ä¸Šè¯æ˜
  â”‚    â”œâ”€ è¯»å– ComputationResult å¯¹è±¡
  â”‚    â”œâ”€ æ£€æŸ¥: result.verified = true
  â”‚    â””â”€ ç¡®è®¤: ç»“æœæœªè¢«ç¯¡æ”¹
  â”‚
  â””â”€ 3. å®¡è®¡è¿½è¸ª
       â”œâ”€ DataRegistered: æ•°æ®ä½•æ—¶ä¸Šä¼ 
       â”œâ”€ DataPurchased: è°è´­ä¹°äº†æ•°æ®
       â”œâ”€ KeyDistributed: å¯†é’¥åˆ†å‘æ—¶é—´
       â”œâ”€ ProofSubmitted: è¯æ˜æäº¤è®°å½•
       â””â”€ ProofVerified: éªŒè¯ç»“æœ

```

---

## ğŸ’¡ æ ¸å¿ƒåŠŸèƒ½è¯´æ˜

### 1. æ•°æ®ä¸Šä¼ ä¸åŠ å¯†

```typescript
// å‰ç«¯è‡ªåŠ¨æ‰§è¡Œ
1. é€‰æ‹©æ–‡ä»¶ï¼ˆCSV/JSON/Excelï¼‰
2. AES-256-GCM åŠ å¯†åŸå§‹æ•°æ®
3. ä¸Šä¼ åŠ å¯† Blob åˆ° Walrus
4. åœ¨ Sui é“¾ä¸Šæ³¨å†Œå…ƒæ•°æ®ï¼ˆBlobIDã€å“ˆå¸Œã€å¤§å°ç­‰ï¼‰
5. æœ¬åœ°å­˜å‚¨åŠ å¯†å¯†é’¥ï¼ˆç”¨äºåç»­åˆ†å‘ï¼‰
```

### 2. æ•°æ®è´­ä¹°ä¸å¯†é’¥åˆ†å‘

```typescript
// å®‰å…¨çš„å¯†é’¥åˆ†å‘æœºåˆ¶
1. ä¹°å®¶åœ¨å¸‚åœºè´­ä¹°æ•°æ®è®¿é—®æƒé™
2. æ”¯ä»˜ SUIï¼ˆ92.5% ç»™å–å®¶ï¼Œ5% éªŒè¯è€…å¥–åŠ±ï¼Œ2.5% å¹³å°è´¹ï¼‰
3. å–å®¶æ£€æµ‹åˆ°è´­ä¹°äº‹ä»¶
4. ä½¿ç”¨ä¹°å®¶çš„ X25519 å…¬é’¥åŠ å¯†å¯¹ç§°å¯†é’¥
5. è°ƒç”¨ distribute_key_to_buyer åˆ†å‘åŠ å¯†å¯†é’¥
6. ä¹°å®¶ä½¿ç”¨ç§é’¥è§£å¯†ï¼Œè·å¾—æ•°æ®è®¿é—®èƒ½åŠ›
```

### 3. é›¶çŸ¥è¯†è¯æ˜è®¡ç®—

#### Averageï¼ˆå¹³å‡å€¼è®¡ç®—ï¼‰

```circom
// è¾“å…¥: ç§æœ‰æ•°æ® [45, 38, 62]
// è¾“å‡º: å¹³å‡å€¼ = 48.33 (å…¬å¼€)
//       æ‰¿è¯º = hash(data) (å…¬å¼€ï¼Œç”¨äºéªŒè¯æ•°æ®å®Œæ•´æ€§)
// ä¼˜åŠ¿: ä¸æ³„éœ²ä»»ä½•åŸå§‹æ•°æ®
```

#### Threshold Queryï¼ˆé˜ˆå€¼æŸ¥è¯¢ï¼‰

```circom
// è¾“å…¥: ç§æœ‰æ•°æ® [25, 45, 60, 18, 72, 38, 55]
//       é˜ˆå€¼ = 50 (å…¬å¼€)
// è¾“å‡º: count = 3 (å…¬å¼€ï¼Œè¡¨ç¤º 3 ä¸ªæ•°æ® > 50)
//       æ‰¿è¯º = hash(data) (å…¬å¼€)
// ä¼˜åŠ¿: åªçŸ¥é“æ•°é‡ï¼Œä¸çŸ¥é“å…·ä½“æ˜¯å“ªäº›æ•°æ®
```

### 4. é“¾ä¸ŠéªŒè¯

```move
// zkp_verifier.move
public entry fun verify_proof(
    registry: &mut ZKPRegistry,
    result: &mut ComputationResult,
    vk: &VerificationKey,
    clock: &Clock,
    ctx: &mut TxContext
) {
    // ä½¿ç”¨ Sui åŸç”Ÿ Groth16 éªŒè¯å™¨
    let is_valid = groth16::verify_groth16_proof(&curve, &pvk, &inputs, &points);
    
    if (is_valid) {
        result.verified = true;
        // è§¦å‘ ProofVerified äº‹ä»¶
    }
}
```

---

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### å¤šå±‚åŠ å¯†æ¶æ„

1. **å­˜å‚¨å±‚åŠ å¯†**: AES-256-GCM åŠ å¯† Blobï¼ˆ256-bit éšæœºå¯†é’¥ï¼‰
2. **å¯†é’¥äº¤æ¢åŠ å¯†**: X25519 ECDH éå¯¹ç§°åŠ å¯†åˆ†å‘å¯¹ç§°å¯†é’¥
3. **æœ¬åœ°å¯†é’¥åŠ å¯†**: PBKDF2 (100,000 iterations) + AES-GCM ä¿æŠ¤æœ¬åœ°å¯†é’¥
4. **é›¶çŸ¥è¯†è¯æ˜**: Groth16 ä¿è¯è®¡ç®—æ­£ç¡®æ€§ï¼Œæ— éœ€æš´éœ²åŸå§‹æ•°æ®

### å¯†é’¥å®‰å…¨å­˜å‚¨

#### ä¹°å®¶ç§é’¥ï¼ˆX25519 ECDHï¼‰
- ğŸ” ä½¿ç”¨ **PBKDF2 (100,000 iterations) + AES-256-GCM** åŠ å¯†
- ğŸ“¦ å­˜å‚¨åœ¨ **IndexedDB** çš„ `keys` object storeï¼ˆæ•°æ®åº“ï¼š`hydra-secure`ï¼‰
- ğŸ”‘ å¯†ç ä»…åœ¨ `sessionStorage` ç¼“å­˜ï¼Œæµè§ˆå™¨åˆ·æ–°å³æ¸…é™¤
- â±ï¸ ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶å¼¹å‡ºå¯†ç è¾“å…¥æ¡†ï¼Œä¹‹ååœ¨å½“å‰ä¼šè¯ä¸­è‡ªåŠ¨ä½¿ç”¨

#### å¯¹ç§°åŠ å¯†å¯†é’¥ï¼ˆAES-256 æ•°æ®å¯†é’¥ï¼‰
- ğŸ” ä½¿ç”¨**ç›¸åŒçš„å¯†ç **æ´¾ç”Ÿå¯†é’¥è¿›è¡ŒäºŒæ¬¡åŠ å¯†
- ğŸ“¦ å­˜å‚¨åœ¨ **IndexedDB** çš„ `symmetric-keys` object store
- ğŸ”„ è‡ªåŠ¨è¿ç§»ï¼šæ£€æµ‹åˆ°æ—§ `localStorage` æ•°æ®æ—¶ï¼Œè‡ªåŠ¨åŠ å¯†å¹¶è¿ç§»åˆ°å®‰å…¨å­˜å‚¨
- âŒ ä¸å†åœ¨ `localStorage` ä¸­æ˜æ–‡å­˜å‚¨ï¼ˆå·²åºŸå¼ƒï¼‰

#### å®‰å…¨ä¿è¯
- âœ… **ç¦»çº¿å®‰å…¨**ï¼šå³ä½¿æµè§ˆå™¨æ•°æ®è¢«å¯¼å‡ºï¼Œæ²¡æœ‰å¯†ç ä¹Ÿæ— æ³•è§£å¯†ä»»ä½•å¯†é’¥
- âœ… **å‰å‘ä¿å¯†**ï¼šå¯†ç å¯å®šæœŸæ›´æ¢ï¼Œé‡æ–°åŠ å¯†æ‰€æœ‰å¯†é’¥
- âœ… **ä¼šè¯éš”ç¦»**ï¼šå¯†ç ç¼“å­˜ä»…åœ¨å½“å‰ä¼šè¯æœ‰æ•ˆï¼Œè·¨æ ‡ç­¾é¡µä¸å…±äº«
- âœ… **å‘åå…¼å®¹**ï¼šè‡ªåŠ¨æ£€æµ‹å¹¶è¿ç§»æ—§ç‰ˆæœ¬çš„æ˜æ–‡å¯†é’¥
- âœ… **å¯†ç ç­–ç•¥**ï¼šæ¨èä½¿ç”¨å¼ºå¯†ç ï¼ˆâ‰¥12ä½ï¼ŒåŒ…å«å¤§å°å†™+æ•°å­—+ç¬¦å·ï¼‰

### è®¿é—®æ§åˆ¶

- âœ… æ•°æ®æ‰€æœ‰è€…ï¼šå®Œå…¨è®¿é—®æƒé™
- âœ… å·²è´­ä¹°ç”¨æˆ·ï¼šé€šè¿‡ `has_purchased` éªŒè¯
- âœ… æˆæƒç”¨æˆ·ï¼šé€šè¿‡ `AccessGrant` éªŒè¯
- âŒ æœªæˆæƒç”¨æˆ·ï¼šæ— æ³•è®¿é—®åŠ å¯†æ•°æ®

### é˜²ä½œå¼Šæœºåˆ¶

- **é“¾ä¸ŠéªŒè¯**: æ‰€æœ‰ ZKP è¯æ˜å¿…é¡»é€šè¿‡ Groth16 éªŒè¯
- **æ•°æ®æ‰¿è¯º**: Poseidon å“ˆå¸Œç¡®ä¿æ•°æ®å®Œæ•´æ€§
- **åŒé‡æ£€æŸ¥**: å‰ç«¯ç”Ÿæˆè¯æ˜ + é“¾ä¸ŠéªŒè¯ï¼Œé˜²æ­¢è™šå‡è¯æ˜

---

## ğŸ†š ä¸ç°æœ‰æ–¹æ¡ˆçš„æ·±åº¦å¯¹æ¯”

### æŠ€æœ¯ç»´åº¦å¯¹æ¯”

| **ç»´åº¦** | **ä¼ ç»Ÿäº‘è®¡ç®— (AWS/Azure)** | **åŒºå—é“¾æ•°æ®å¸‚åœº (Ocean)** | **MPCæ–¹æ¡ˆ (Enigma)** | **HydraProtocol** |
|---------|---------------------------|--------------------------|---------------------|-------------------|
| **æ•°æ®å­˜å‚¨** | ä¸­å¿ƒåŒ–æœåŠ¡å™¨ | IPFS (ä¸­å¿ƒåŒ–ç½‘å…³) | é“¾ä¸Š/IPFS | **Walrus (å®Œå…¨å»ä¸­å¿ƒåŒ–)** |
| **æ•°æ®åŠ å¯†** | TLSä¼ è¾“å±‚åŠ å¯† | å¯é€‰åŠ å¯† | ç§˜å¯†å…±äº« | **AES-256-GCM + X25519** |
| **éšç§è®¡ç®—** | TEE (SGX/SEV) | âŒ ä¸æ”¯æŒ | MPC (éœ€3+èŠ‚ç‚¹åœ¨çº¿) | **ZKP (å•æ–¹å³å¯)** |
| **è®¡ç®—éªŒè¯** | ä¿¡ä»»æœåŠ¡å•† | âŒ æ— éªŒè¯ | éƒ¨åˆ†éªŒè¯ | **é“¾ä¸Š Groth16 éªŒè¯** |
| å¯†é’¥ç®¡ç† | HSMç¡¬ä»¶æ¨¡å— | ä¸­å¿ƒåŒ–æ‰˜ç®¡ | ç§˜å¯†å…±äº« (t-of-n) | **X25519 ECDH + PBKDF2åŠ å¯†å­˜å‚¨** |
| **æŠ—å®¡æŸ¥æ€§** | âŒ å¯è¢«å…³åœ | éƒ¨åˆ†æŠ—å®¡æŸ¥ | ä¾èµ–èŠ‚ç‚¹ç½‘ç»œ | **âœ… æ°¸ä¹…å­˜å‚¨** |
| **Gasæˆæœ¬** | $0 (ä¸­å¿ƒåŒ–) | é«˜ (ä»¥å¤ªåŠ ~$50/tx) | ä¸­ç­‰ | **æä½ (~$0.02/tx)** |
| **TPS** | >100K | <20 | <100 | **>10K (Sui)** |
| **å¯æ‰©å±•æ€§** | âœ… é«˜ | âŒ å·® | âŒ å·® | **âœ… é«˜ (Suiå¹¶å‘)** |

### å®‰å…¨æ€§å¯¹æ¯”

| **æ”»å‡»å‘é‡** | **ä¼ ç»Ÿæ–¹æ¡ˆ** | **Ocean Protocol** | **HydraProtocol** |
|------------|-------------|-------------------|-------------------|
| **æ•°æ®æ³„éœ²** | âš ï¸ æœåŠ¡å™¨å…¥ä¾µ â†’ å…¨éƒ¨æ³„éœ² | âš ï¸ IPFSç½‘å…³æ³„éœ² | âœ… ç«¯åˆ°ç«¯åŠ å¯†ï¼Œæ— æ³•æ³„éœ² |
| **ä¸­é—´äººæ”»å‡»** | âš ï¸ TLSé™çº§æ”»å‡» | âš ï¸ ç½‘å…³ç¯¡æ”¹ | âœ… å¯†é’¥é“¾ä¸ŠåŠ å¯†åˆ†å‘ |
| **æ•°æ®ç¯¡æ”¹** | âš ï¸ æ•°æ®åº“è¢«ä¿®æ”¹ | âœ… åŒºå—é“¾ä¸å¯ç¯¡æ”¹ | âœ… Walrus + åŒºå—é“¾åŒé‡ä¿éšœ |
| **æ¶æ„è®¡ç®—** | âš ï¸ æœåŠ¡å™¨è¿”å›è™šå‡ç»“æœ | âŒ æ— éªŒè¯æœºåˆ¶ | âœ… ZKP å¯†ç å­¦è¯æ˜ |
| **å¯†é’¥æ³„éœ²** | âš ï¸ HSMè¢«æ”»ç ´ â†’ å…¨éƒ¨æ³„éœ² | âš ï¸ ä¸­å¿ƒåŒ–å¯†é’¥æœåŠ¡å™¨ | âœ… æ¯ä¸ªä¹°å®¶ç‹¬ç«‹å¯†é’¥ |
| **Sybilæ”»å‡»** | N/A | âš ï¸ åˆ·å•è¯„åˆ† | âœ… è´¨æŠ¼æœºåˆ¶é˜²æŠ¤ |
| **DDoSæ”»å‡»** | âš ï¸ å•ç‚¹æ•…éšœ | âš ï¸ IPFSç½‘å…³ | âœ… Walrusåˆ†å¸ƒå¼ç½‘ç»œ |

### ç”¨æˆ·ä½“éªŒå¯¹æ¯”

| **åŠŸèƒ½** | **Ocean Protocol** | **HydraProtocol** |
|---------|-------------------|-------------------|
| **æ•°æ®ä¸Šä¼ ** | éœ€æ‰‹åŠ¨æŒ‡å®šå…ƒæ•°æ® | âœ… è‡ªåŠ¨è¯†åˆ«åˆ— + ç±»å‹æ¨æ–­ |
| **æ•°æ®é¢„è§ˆ** | âŒ ä¸æ”¯æŒ | âœ… åŠ å¯†çŠ¶æ€ä¸‹ç»Ÿè®¡é¢„è§ˆ |
| **å¯†é’¥åˆ†å‘** | æ‰‹åŠ¨è”ç³»å–å®¶ | âœ… è‡ªåŠ¨åˆ†å‘ (useAutoDistributeKeys) |
| **è®¡ç®—ç±»å‹** | âŒ ä»…æ•°æ®ä¸‹è½½ | âœ… Average + Threshold + å¯æ‰©å±• |
| **ç»“æœéªŒè¯** | ä¿¡ä»»ä¹°å®¶ | âœ… é“¾ä¸Š ZKP éªŒè¯ï¼Œä»»ä½•äººå¯å®¡è®¡ |
| **å¤šæ•°æ®é›†è®¡ç®—** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒå¤šä¸ª DataRecord è”åˆè®¡ç®— |
| **ç§»åŠ¨ç«¯æ”¯æŒ** | éƒ¨åˆ†æ”¯æŒ | âœ… å“åº”å¼è®¾è®¡ï¼Œç§»åŠ¨ç«¯å‹å¥½ |

---

## âš™ï¸ å…³é”®æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. Circom ç”µè·¯è®¾è®¡

#### Average ç”µè·¯çš„æ•°å­¦åŸç†

```circom
// average.circom å…³é”®çº¦æŸ
template Average(n) {
    signal input data[n];
    signal output avg;
    signal output commitment;

    // çº¦æŸ1: è®¡ç®—æ€»å’Œ
    var sum = 0;
    for (var i = 0; i < n; i++) {
        sum = sum + data[i];
    }
    signal tempSum;
    tempSum <== sum;

    // çº¦æŸ2: æ•´æ•°é™¤æ³•éªŒè¯
    // ä¿è¯ avg æ˜¯æ­£ç¡®çš„: sum - avg*n < n
    component lt = LessThan(64);
    lt.in[0] <== tempSum - avg * n;
    lt.in[1] <== n;
    lt.out === 1;  // å¿…é¡»ä¸ºçœŸ

    // çº¦æŸ3: æ•°æ®æ‰¿è¯º (Poseidonå“ˆå¸Œ)
    component hasher = Poseidon(n);
    for (var i = 0; i < n; i++) {
        hasher.inputs[i] <== data[i];
    }
    commitment <== hasher.out;

    // çº¦æŸ4: èŒƒå›´æ£€æŸ¥ (é˜²æ­¢è´Ÿæ•°/æº¢å‡º)
    component rangeChecks[n];
    for (var i = 0; i < n; i++) {
        rangeChecks[i] = Num2Bits(32);
        rangeChecks[i].in <== data[i];  // ç¡®ä¿æ¯ä¸ªæ•°æ® <= 2^32
    }
}
```

**ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡æ˜¯å®‰å…¨çš„ï¼Ÿ**
1. **é›¶çŸ¥è¯†æ€§**: `data[n]` æ˜¯ç§æœ‰è¾“å…¥ï¼Œæ°¸ä¸å…¬å¼€
2. **å®Œæ•´æ€§**: `commitment` ç»‘å®šäº†åŸå§‹æ•°æ®ï¼Œæ— æ³•æ›¿æ¢
3. **æ­£ç¡®æ€§**: çº¦æŸç¡®ä¿ `avg` ç¡®å®æ˜¯ `sum / n` çš„æ•´æ•°é™¤æ³•ç»“æœ
4. **å¯éªŒè¯æ€§**: Groth16 è¯æ˜å¯åœ¨é“¾ä¸Šå¿«é€ŸéªŒè¯ (<1ms)

#### Threshold Query çš„æ¯”è¾ƒç”µè·¯

```circom
// threshold.circom æ ¸å¿ƒé€»è¾‘
template ThresholdQuery(n) {
    signal input data[n];
    signal input threshold;  // å…¬å¼€è¾“å…¥
    signal input salt;       // éšæœºç›å€¼
    signal output count;
    signal output commitment;

    // å¯¹æ¯ä¸ªæ•°æ®ç‚¹è¿›è¡Œæ¯”è¾ƒ
    component comparators[n];
    signal isAboveThreshold[n];

    for (var i = 0; i < n; i++) {
        comparators[i] = GreaterThan(32);
        comparators[i].in[0] <== data[i];
        comparators[i].in[1] <== threshold;
        
        // isAboveThreshold[i] = 1 if data[i] > threshold, else 0
        isAboveThreshold[i] <== comparators[i].out;
    }

    // ç´¯åŠ è®¡æ•°
    var totalCount = 0;
    for (var i = 0; i < n; i++) {
        totalCount = totalCount + isAboveThreshold[i];
    }
    count <== totalCount;

    // æ‰¿è¯ºåŒ…å«åŸå§‹æ•°æ®å’Œç›å€¼
    component hasher = Poseidon(n + 1);
    for (var i = 0; i < n; i++) {
        hasher.inputs[i] <== data[i];
    }
    hasher.inputs[n] <== salt;
    commitment <== hasher.out;
}
```

**Threshold Query çš„åº”ç”¨åœºæ™¯**ï¼š
```
åŒ»ç–—åœºæ™¯: ç»Ÿè®¡"è¡€ç³– > 7.0 mmol/L"çš„æ‚£è€…æ¯”ä¾‹
  â†’ ä¸æ³„éœ²ä»»ä½•æ‚£è€…çš„å…·ä½“è¡€ç³–å€¼
  
é‡‘èåœºæ™¯: ç»Ÿè®¡"è´·æ¬¾è¿çº¦ç‡ > 5%"çš„å®¢æˆ·æ•°é‡
  â†’ ä¸æ³„éœ²ä»»ä½•å®¢æˆ·çš„è¿çº¦æƒ…å†µ
  
ä¾›åº”é“¾: ç»Ÿè®¡"åº“å­˜ < å®‰å…¨çº¿"çš„SKUæ•°é‡
  â†’ ä¸æ³„éœ²å…·ä½“åº“å­˜æ•°é‡
```

### 2. Sui Move æ™ºèƒ½åˆçº¦æ¶æ„

#### DataRegistry çš„è®¿é—®æ§åˆ¶æ¨¡å‹

```move
// data_registry.move å…³é”®è®¾è®¡
public struct DataRecord has key, store {
    id: UID,
    owner: address,
    walrus_blob_id: String,
    encrypted: bool,
    // æ ¸å¿ƒ: ä¸ºæ¯ä¸ªä¹°å®¶å­˜å‚¨ç‹¬ç«‹çš„åŠ å¯†å¯†é’¥
    encryption_keys: Table<address, vector<u8>>,
    // æˆæƒåˆ—è¡¨: æ”¯æŒç»†ç²’åº¦æƒé™æ§åˆ¶
    access_grants: Table<address, ID>,
    is_public: bool,
    ...
}

// ä¸‰å±‚è®¿é—®æ§åˆ¶:
// 1. Owner: å®Œå…¨æ§åˆ¶æƒ
// 2. Purchaser: has_encrypted_key_for() = true
// 3. Grantee: has_access_grant() = true (æ‰‹åŠ¨æˆæƒ)

public fun has_encrypted_key_for(
    data_record: &DataRecord, 
    requester: address
): bool {
    table::contains(&data_record.encryption_keys, requester)
}
```

**ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ**
- âœ… **éšç§**: æ¯ä¸ªä¹°å®¶çš„å¯†é’¥ç‹¬ç«‹åŠ å¯†ï¼Œäº’ä¸å¯è§
- âœ… **çµæ´»**: æ”¯æŒå¯†é’¥æ’¤é”€ (remove from encryption_keys)
- âœ… **å¯æ‰©å±•**: æ”¯æŒæ‰¹é‡æˆæƒã€æ—¶é—´é™åˆ¶ç­‰é«˜çº§åŠŸèƒ½

#### Market çš„è´¹ç”¨åˆ†é…æœºåˆ¶

```move
// market.move å…³é”®ä»£ç 
public entry fun purchase_data_access(...) {
    let price = listing.price;  // ä¾‹å¦‚: 10 SUI
    
    // è´¹ç”¨åˆ†é… (basis points: 10000 = 100%)
    let platform_fee = (price * 250) / 10000;    // 2.5% = 0.25 SUI
    let verifier_reward = (price * 500) / 10000; // 5% = 0.5 SUI
    let owner_revenue = price - platform_fee - verifier_reward; // 92.5% = 9.25 SUI
    
    // åŸå­æ€§æ“ä½œ: è¦ä¹ˆå…¨éƒ¨æˆåŠŸ,è¦ä¹ˆå…¨éƒ¨å›æ»š
    let mut payment_balance = coin::into_balance(payment);
    
    // å¹³å°è´¹ â†’ marketplace.platform_balance
    let platform_coin = balance::split(&mut payment_balance, platform_fee);
    balance::join(&mut marketplace.platform_balance, platform_coin);
    
    // éªŒè¯è€…å¥–åŠ± â†’ marketplace.reward_pool
    let reward_coin = balance::split(&mut payment_balance, verifier_reward);
    balance::join(&mut marketplace.reward_pool, reward_coin);
    
    // å‰©ä½™é‡‘é¢ â†’ æ•°æ®æ‰€æœ‰è€…
    let owner_coin = coin::from_balance(payment_balance, ctx);
    transfer::public_transfer(owner_coin, listing.owner);
    
    // è®°å½•è´­ä¹°å‡­è¯
    table::add(&mut listing.purchasers, sender, true);
}
```

**è®¾è®¡ä¼˜åŠ¿**ï¼š
- âœ… **åŸå­æ€§**: ä½¿ç”¨ Sui çš„äº‹åŠ¡ç‰¹æ€§,ä¿è¯è¦ä¹ˆå…¨éƒ¨æˆåŠŸ
- âœ… **é€æ˜**: è´¹ç‡å†™æ­»åœ¨åˆçº¦,ä»»ä½•äººå¯å®¡è®¡
- âœ… **å¯å‡çº§**: DAO æ²»ç†å¯è°ƒæ•´è´¹ç‡å‚æ•°

### 3. å‰ç«¯ ZKP é›†æˆ (SnarkJS)

#### æµè§ˆå™¨ç«¯è¯æ˜ç”Ÿæˆæµç¨‹

```typescript
// frontend/src/utils/zkp-browser.ts
export async function generateProof(
  circuitType: 'average' | 'threshold',
  input: number[],
  threshold?: number
): Promise<ProofResult> {
  // 1. å‡†å¤‡ç”µè·¯è¾“å…¥
  const circuitInput: Record<string, any> = {};
  
  if (circuitType === 'average') {
    circuitInput.data = input.slice(0, 3);  // Average ç”µè·¯å›ºå®š n=3
  } else if (circuitType === 'threshold') {
    circuitInput.data = input.slice(0, 10);  // Threshold ç”µè·¯å›ºå®š n=10
    circuitInput.threshold = threshold || 50;
    circuitInput.salt = Math.floor(Math.random() * 1000000);  // éšæœºç›å€¼
  }

  // 2. ç”Ÿæˆ Witness (è®¡ç®—ç”µè·¯çš„æ‰€æœ‰ä¸­é—´ä¿¡å·)
  const wasmPath = `/circuits/${circuitType}/${circuitType}.wasm`;
  const { witness } = await snarkjs.wtns.calculate(
    circuitInput, 
    wasmPath
  );

  // 3. ç”Ÿæˆ Groth16 è¯æ˜ (è€—æ—¶æ“ä½œ: 10-30ç§’)
  const zkeyPath = `/circuits/${circuitType}/circuit_final.zkey`;
  const { proof, publicSignals } = await snarkjs.groth16.prove(
    zkeyPath, 
    witness
  );

  // 4. åºåˆ—åŒ–è¯æ˜ä¸ºå­—èŠ‚æ•°ç»„ (ç”¨äºé“¾ä¸ŠéªŒè¯)
  const proofBytes = new Uint8Array([
    ...hexToBytes(proof.pi_a[0]),  // 96 bytes
    ...hexToBytes(proof.pi_b[0]),  // 96 bytes (å‹ç¼©å)
    ...hexToBytes(proof.pi_c[0]),  // 96 bytes
  ]); // æ€»è®¡ 192 bytes

  const publicInputsBytes = publicSignals.map(s => 
    BigInt(s).toString()
  );

  return { proof: proofBytes, publicSignals: publicInputsBytes };
}
```

**æ€§èƒ½ä¼˜åŒ–æŠ€å·§**ï¼š
1. **é¢„åŠ è½½ç”µè·¯**: åœ¨é¡µé¢åŠ è½½æ—¶é¢„å– `.wasm` å’Œ `.zkey` æ–‡ä»¶
2. **Web Workers**: åœ¨åå°çº¿ç¨‹ç”Ÿæˆè¯æ˜,ä¸é˜»å¡ UI
3. **ç¼“å­˜**: ä½¿ç”¨ Service Worker ç¼“å­˜ç”µè·¯æ–‡ä»¶ (å‡å°‘ç½‘ç»œå»¶è¿Ÿ)
4. **æ¸è¿›å¼ä½“éªŒ**: æ˜¾ç¤ºè¿›åº¦æ¡ (0% â†’ 50% â†’ 100%)

### 4. X25519 å¯†é’¥åˆ†å‘å®ç°

#### å‰ç«¯å¯†é’¥äº¤æ¢ä»£ç 

```typescript
// frontend/src/hooks/useAutoDistributeKeys.ts
import { readSymmetricKey, saveSymmetricKey } from '../utils/secure-store';

async function distributeKeyToBuyer(buyer: address, blobId: string) {
  // 1. ä»åŠ å¯†çš„ IndexedDB è¯»å– AES å¯†é’¥ï¼ˆéœ€å¯†ç è§£å¯†ï¼‰
  let symKey = await readSymmetricKey(blobId);
  
  // å…¼å®¹æ—§ç‰ˆæœ¬ï¼šè‡ªåŠ¨è¿ç§» localStorage ä¸­çš„æ˜æ–‡å¯†é’¥
  if (!symKey) {
    const legacyB64 = localStorage.getItem(`hydra:blobKey:${blobId}`);
    if (legacyB64) {
      const legacyBytes = Uint8Array.from(atob(legacyB64), c => c.charCodeAt(0));
      await saveSymmetricKey(blobId, legacyBytes); // åŠ å¯†å­˜å‚¨
      localStorage.removeItem(`hydra:blobKey:${blobId}`); // åˆ é™¤æ˜æ–‡
      symKey = legacyBytes;
    }
  }
  
  if (!symKey) throw new Error('Missing symmetric key');
  
  // 2. ä»é“¾ä¸Šè¯»å–ä¹°å®¶çš„ X25519 å…¬é’¥
  const buyerPubKey = await suiClient.call('data_registry::get_user_pubkey', [
    CONTRACT_ADDRESSES.dataRegistryId,
    buyer
  ]);

  // 3. ä½¿ç”¨ X25519 ECDH ç”Ÿæˆå…±äº«å¯†é’¥
  const sellerPrivKey = x25519.utils.randomPrivateKey();
  const sellerPubKey = x25519.getPublicKey(sellerPrivKey);
  const sharedSecret = x25519.getSharedSecret(sellerPrivKey, buyerPubKey);
  
  // 4. ä½¿ç”¨å…±äº«å¯†é’¥åŠ å¯†å¯¹ç§°å¯†é’¥
  const iv = crypto.getRandomValues(new Uint8Array(12));
  const aesKey = await crypto.subtle.importKey(
    'raw', sharedSecret, 
    { name: 'AES-GCM', length: 256 }, 
    false, ['encrypt']
  );
  const encryptedKey = await crypto.subtle.encrypt(
    { name: 'AES-GCM', iv },
    aesKey,
    symKey
  );
  
  // 5. æ„é€ è½½è·ï¼š[å–å®¶å…¬é’¥(32) | IV(12) | å¯†æ–‡+Tag]
  const payload = new Uint8Array(
    sellerPubKey.length + iv.length + new Uint8Array(encryptedKey).length
  );
  payload.set(sellerPubKey, 0);
  payload.set(iv, sellerPubKey.length);
  payload.set(new Uint8Array(encryptedKey), sellerPubKey.length + iv.length);

  // 6. è°ƒç”¨é“¾ä¸Šå‡½æ•°åˆ†å‘åŠ å¯†å¯†é’¥
  const tx = new Transaction();
  tx.moveCall({
    target: `${packageId}::market::distribute_key_to_buyer`,
    arguments: [
      tx.object(listingId),
      tx.object(dataRecordId),
      tx.pure.address(buyer),
      tx.pure.vector('u8', Array.from(payload))
    ]
  });

  await signAndExecuteTransaction({ transaction: tx });
}
```

**å®‰å…¨æ€§åˆ†æ**ï¼š
- âœ… **å‰å‘ä¿å¯†**: å³ä½¿å–å®¶ç§é’¥æ³„éœ²,è¿‡å»çš„å¯†é’¥äº¤æ¢ä»å®‰å…¨
- âœ… **ä¸å¯å¦è®¤**: é“¾ä¸Šäº‹ä»¶è®°å½•äº†å¯†é’¥åˆ†å‘æ—¶é—´å’Œå†…å®¹å“ˆå¸Œ
- âœ… **é˜²é‡æ”¾**: æ¯æ¬¡å¯†é’¥äº¤æ¢ä½¿ç”¨ä¸åŒçš„ nonce

---

## ğŸ“Š ç³»ç»ŸæŒ‡æ ‡

| æŒ‡æ ‡                | æ€§èƒ½                              |
|---------------------|-----------------------------------|
| ZKP ç”Ÿæˆæ—¶é—´        | 10-30 ç§’ (æµè§ˆå™¨ç«¯)               |
| é“¾ä¸ŠéªŒè¯æ—¶é—´        | < 1 æ¯«ç§’                          |
| Sui äº¤æ˜“ç¡®è®¤        | ~0.5 ç§’                           |
| Walrus ä¸Šä¼ é€Ÿåº¦     | ~5 MB/s (å–å†³äºç½‘ç»œ)              |
| Gas è´¹ç”¨            | ~0.02-0.05 SUI/äº¤æ˜“               |
| æ”¯æŒæ•°æ®å¤§å°        | æœ€å¤§ 100 MB (åˆçº¦é™åˆ¶å¯è°ƒæ•´)       |

---

## ğŸ›£ï¸ è·¯çº¿å›¾

### âœ… Phase 1 - MVP (å·²å®Œæˆ)
- [x] åŸºç¡€æ•°æ®ä¸Šä¼ ä¸å­˜å‚¨
- [x] ZKP ç”µè·¯ï¼ˆAverage, Thresholdï¼‰
- [x] æ•°æ®å¸‚åœºä¸è´­ä¹°
- [x] å®‰å…¨å¯†é’¥åˆ†å‘

### ğŸ”„ Phase 2 - å¢å¼ºåŠŸèƒ½ (è¿›è¡Œä¸­)
- [ ] æ›´å¤š ZKP ç”µè·¯ï¼ˆæ–¹å·®ã€ä¸­ä½æ•°ã€å›å½’åˆ†æï¼‰
- [ ] æ•°æ®è´¨é‡è¯„åˆ†ç³»ç»Ÿ
- [ ] DAO æ²»ç†æ¨¡å—
- [ ] è·¨é“¾æ¡¥æ¥

### ğŸš€ Phase 3 - è§„æ¨¡åŒ–
- [ ] TEE/FHE é›†æˆï¼ˆæ··åˆéšç§è®¡ç®—ï¼‰
- [ ] å»ä¸­å¿ƒåŒ–è®¡ç®—èŠ‚ç‚¹ç½‘ç»œ
- [ ] ä¼ä¸šçº§ SDK å’Œ API
- [ ] ç›‘ç®¡åˆè§„å·¥å…·

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿ç¤¾åŒºè´¡çŒ®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

---

<div align="center">
  <sub>Built with â¤ï¸ for Walrus Haulout Hackathon</sub>
</div>
